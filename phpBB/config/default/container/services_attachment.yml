services:
    attachment.manager:
        class: phpbb\attachment\manager
        shared: false
        arguments:
            - '@config'
            - '@attachment.input.driver_collection'
            - '@attachment.storage.driver_collection'

# ----- Attachment drivers -----
    attachment.input.driver_collection:
        class: phpbb\di\service_collection
        arguments:
            - '@service_container'
        tags:
            - { name: service_collection, tag: attachments.driver.input }

    attachment.storage.driver_collection:
        class: phpbb\di\service_collection
        arguments:
            - '@service_container'
        tags:
            - { name: service_collection, tag: attachments.driver.storage }

    attachment.driver.input.upload:
        class: phpbb\attachment\drivers\input\upload
        arguments:
            - '@attachment.local.delete'
            - '@attachment.local.resync'
            - '@attachment.local.upload'
        tags:
            - { name: attachments.driver.input }

    attachment.local.delete:
        class: phpbb\attachment\drivers\input\upload\delete
        shared: false
        arguments:
            - '@config'
            - '@dbal.conn'
            - '@dispatcher'
            - '@filesystem'
            - '@attachment.local.resync'
            - '%core.root_path%'

    attachment.local.resync:
        class: phpbb\attachment\drivers\input\upload\resync
        shared: false
        arguments:
            - '@dbal.conn'

    attachment.local.upload:
        class: phpbb\attachment\drivers\input\upload\upload
        shared: false
        arguments:
            - '@auth'
            - '@cache'
            - '@config'
            - '@files.upload'
            - '@language'
            - '@mimetype.guesser'
            - '@dispatcher'
            - '@plupload'
            - '@user'
            - '%core.root_path%'
